// Assets.pi - Asset Management Domain
// Comprehensive asset tracking and management

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client-assets"
}

datasource db {
  provider = "postgresql"
  url      = env("ASSETS_DATABASE_URL")
}

// Portfolio Management
model Portfolio {
  id          String   @id @default(cuid())
  userId      String
  name        String
  description String?
  totalValue  Float    @default(0)
  currency    String   @default("PI")
  status      String   @default("ACTIVE")
  
  investments Investment[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([userId])
  @@map("assets_portfolios")
}

// Investment Holdings
model Investment {
  id              String    @id @default(cuid())
  portfolioId     String
  portfolio       Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  
  assetType       String    // CRYPTO, STOCKS, BONDS, COMMODITIES, REAL_ESTATE
  assetSymbol     String
  assetName       String
  quantity        Float
  averageCost     Float
  currentPrice    Float
  totalValue      Float
  
  metadata        Json?
  
  transactions    Transaction[]
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([portfolioId])
  @@index([assetType])
  @@map("assets_investments")
}

// Transaction Log
model Transaction {
  id            String     @id @default(cuid())
  investmentId  String
  investment    Investment @relation(fields: [investmentId], references: [id], onDelete: Cascade)
  
  type          String     // BUY, SELL, TRANSFER, DEPOSIT, WITHDRAWAL
  quantity      Float
  price         Float
  totalAmount   Float
  fees          Float      @default(0)
  currency      String     @default("PI")
  
  notes         String?
  metadata      Json?
  
  executedAt    DateTime   @default(now())
  createdAt     DateTime   @default(now())
  
  @@index([investmentId])
  @@index([type])
  @@index([executedAt])
  @@map("assets_transactions")
}

// Asset Accounts
model Account {
  id            String     @id @default(cuid())
  userId        String
  accountName   String
  accountType   String     // BROKERAGE, WALLET, CUSTODY, BANK
  provider      String?
  balance       Float      @default(0)
  currency      String     @default("PI")
  status        String     @default("ACTIVE")
  
  statements    Statement[]
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  
  @@index([userId])
  @@index([accountType])
  @@map("assets_accounts")
}

// Account Statements
model Statement {
  id            String   @id @default(cuid())
  accountId     String
  account       Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  
  periodStart   DateTime
  periodEnd     DateTime
  openingBalance Float
  closingBalance Float
  
  reportUrl     String?
  metadata      Json?
  
  generatedAt   DateTime @default(now())
  
  @@index([accountId])
  @@index([periodStart])
  @@map("assets_statements")
}
