name: "ÙØ­Øµ Ø§Ù„Ø£Ù…Ø§Ù† Ø¹Ø¨Ø± ÙƒÙˆØ¯Ø§Ø³ÙŠ - Codacy Security Scan"

on:
  push:
    branches: [ "main", "develop" ]
  pull_request:
    branches: [ "main" ]

permissions:
  contents: read
  security-events: write # Ø¯ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù„ÙŠ ÙƒØ§Ù†Øª Ù†Ø§Ù‚ØµØ© Ø¹Ø´Ø§Ù† ÙŠØ±ÙØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  actions: read

jobs:
  codacy-security-scan:
    name: "Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© ÙØ­Øµ Ø§Ù„Ø­ÙˆÙƒÙ…Ø© ÙˆØ§Ù„Ø£Ù…Ø§Ù†"
    runs-on: ubuntu-latest
    
    steps:
      - name: "ğŸ“¥ Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ØµØ¯Ø±ÙŠ"
        uses: actions/checkout@v4

      - name: "ğŸ›¡ï¸ ØªØ´ØºÙŠÙ„ Ù…Ø­Ø±Ùƒ ÙØ­Øµ ÙƒÙˆØ¯Ø§Ø³ÙŠ"
        uses: codacy/codacy-analysis-cli-action@v4
        with:
          project-token: ${{ secrets.CODACY_PROJECT_TOKEN }}
          verbose: true
          output: results.sarif
          format: sarif
          directory: "/github/workspace"

      - name: "ğŸ“Š Ø±ÙØ¹ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ù…Ø§Ù† Ø¥Ù„Ù‰ Ø¬ÙŠØª Ù‡Ø§Ø¨"
        # Ø­Ø¯Ø«Ù†Ø§ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ù„Ù€ v4 Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªÙ†Ø¨ÙŠÙ‡ Ø¬ÙŠØª Ù‡Ø§Ø¨ ÙÙŠ Ø§Ù„Ù€ Logs
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: results.sarif
          # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù€ token Ù„Ø¶Ù…Ø§Ù† Ù†Ø¬Ø§Ø­ Ø§Ù„Ø±ÙØ¹
          token: ${{ github.token }}
