generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  piUid         String    @unique  // Standard Pi user ID from Pi.authenticate()
  username      String
  email         String?   @unique
  walletAddress String?   @unique
  tier          String    @default("STANDARD")  // STANDARD, PREMIUM, ELITE, TITAN
  role          String    @default("USER")      // USER, ADMIN, PARTNER
  status        String    @default("ACTIVE")    // ACTIVE, SUSPENDED, PENDING_KYC
  kycStatus     String?   @default("NOT_STARTED")  // Compliance for high-value transactions
  language      String    @default("en")
  balance       Float     @default(0.0)         // Internal Pi balance tracking
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  lastLoginAt   DateTime?

  payments      Payment[]
  // Future: domains Domain[], notifications Notification[]

  @@index([piUid])
  @@index([tier])
  @@index([status])
  @@index([walletAddress])
  @@map("users")
}

model Payment {
  id            String   @id @default(cuid())
  userId        String
  amount        Float
  currency      String   @default("PI")
  piTxId        String?  @unique  // Pi blockchain transaction ID
  status        String   @default("PENDING")  // PENDING, COMPLETED, FAILED, REFUNDED
  domain        String?               // e.g., "tec.com" or "elite.pi"
  category      String                // DOMAIN_PURCHASE, NOTIFICATION, ECOMMERCE, NFT_MINT
  description   String?
  metadata      Json?                 // Flexible: { nftId: "...", tierUpgrade: true }
  createdAt     DateTime @default(now())
  completedAt   DateTime?

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([piTxId])
  @@index([category])
  @@map("payments")
}
